var Ft=(r,t,e)=>{if(!t.has(r))throw TypeError("Cannot "+e)};var ut=(r,t,e)=>{if(t.has(r))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(r):t.set(r,e)};var pt=(r,t,e)=>(Ft(r,t,"access private method"),e);import{hexlify as $t}from"@ethersproject/bytes";import{NativeAssetId as lt}from"@fuel-ts/constants";import{bn as yt}from"@fuel-ts/math";var O=r=>{var s,n,o,p;let t,e,a;return Array.isArray(r)?(e=r[0],t=(s=r[1])!=null?s:lt,a=(n=r[2])!=null?n:void 0):(e=r.amount,t=(o=r.assetId)!=null?o:lt,a=(p=r.max)!=null?p:void 0),{assetId:$t(t),amount:yt(e),max:a?yt(a):void 0}};import u from"graphql-tag";var dt=(e=>(e.Spent="SPENT",e.Unspent="UNSPENT",e))(dt||{});var B=u`
  fragment transactionFragment on Transaction {
    id
    rawPayload
    gasPrice
    status {
      type: __typename
      ... on SubmittedStatus {
        time
      }
      ... on SuccessStatus {
        block {
          id
        }
        time
        programState {
          returnType
          data
        }
      }
      ... on FailureStatus {
        block {
          id
        }
        time
        reason
      }
    }
  }
`,gt=u`
  fragment receiptFragment on Receipt {
    data
    rawPayload
  }
`,j=u`
  fragment coinFragment on Coin {
    utxoId
    owner
    amount
    assetId
    maturity
    status
    blockCreated
  }
`,mt=u`
  fragment messageFragment on Message {
    amount
    sender
    recipient
    data
    nonce
    daHeight
    fuelBlockSpend
  }
`,Ut=u`
  fragment messageProofFragment on MessageProof {
    proofSet
    proofIndex
    sender
    recipient
    nonce
    amount
    data
    signature
    header {
      id
      daHeight
      transactionsCount
      outputMessagesCount
      transactionsRoot
      outputMessagesRoot
      height
      prevRoot
      time
      applicationHash
    }
  }
`,St=u`
  fragment balanceFragment on Balance {
    owner
    amount
    assetId
  }
`,Q=u`
  fragment blockFragment on Block {
    id
    header {
      height
      time
    }
    transactions {
      id
    }
  }
`,Et=u`
  fragment chainInfoFragment on ChainInfo {
    name
    baseChainHeight
    peerCount
    consensusParameters {
      gasPriceFactor
      maxGasPerTx
      maxGasPerTx
      maxScriptLength
    }
    latestBlock {
      ...blockFragment
    }
  }
  ${Q}
`,Nt=u`
  query getVersion {
    nodeInfo {
      nodeVersion
    }
  }
`,Vt=u`
  query getInfo {
    nodeInfo {
      nodeVersion
      minGasPrice
    }
  }
`,Ht=u`
  query getChain {
    chain {
      ...chainInfoFragment
    }
  }
  ${Et}
`,Wt=u`
  query getTransaction($transactionId: TransactionId!) {
    transaction(id: $transactionId) {
      ...transactionFragment
    }
  }
  ${B}
`,vt=u`
  query getTransactionWithReceipts($transactionId: TransactionId!) {
    transaction(id: $transactionId) {
      ...transactionFragment
      receipts {
        ...receiptFragment
      }
    }
  }
  ${B}
  ${gt}
`,Kt=u`
  query getTransactions($after: String, $before: String, $first: Int, $last: Int) {
    transactions(after: $after, before: $before, first: $first, last: $last) {
      edges {
        node {
          ...transactionFragment
        }
      }
    }
  }
  ${B}
`,zt=u`
  query getTransactionsByOwner(
    $owner: Address!
    $after: String
    $before: String
    $first: Int
    $last: Int
  ) {
    transactionsByOwner(owner: $owner, after: $after, before: $before, first: $first, last: $last) {
      edges {
        node {
          ...transactionFragment
        }
      }
    }
  }
  ${B}
`,Zt=u`
  query getBlock($blockId: BlockId, $blockHeight: U64) {
    block(id: $blockId, height: $blockHeight) {
      ...blockFragment
    }
  }
  ${Q}
`,jt=u`
  query getBlockWithTransactions($blockId: BlockId, $blockHeight: U64) {
    block(id: $blockId, height: $blockHeight) {
      ...blockFragment
      transactions {
        ...transactionFragment
      }
    }
  }
  ${Q}
  ${B}
`,Xt=u`
  query getBlocks($after: String, $before: String, $first: Int, $last: Int) {
    blocks(after: $after, before: $before, first: $first, last: $last) {
      edges {
        node {
          ...blockFragment
        }
      }
    }
  }
  ${Q}
`,Jt=u`
  query getCoin($coinId: UtxoId!) {
    coin(utxoId: $coinId) {
      ...coinFragment
    }
  }
  ${j}
`,Yt=u`
  query getCoins(
    $filter: CoinFilterInput!
    $after: String
    $before: String
    $first: Int
    $last: Int
  ) {
    coins(filter: $filter, after: $after, before: $before, first: $first, last: $last) {
      edges {
        node {
          ...coinFragment
        }
      }
    }
  }
  ${j}
`,te=u`
  query getResourcesToSpend(
    $owner: Address!
    $queryPerAsset: [SpendQueryElementInput!]!
    $excludedIds: ExcludeInput
  ) {
    resourcesToSpend(owner: $owner, queryPerAsset: $queryPerAsset, excludedIds: $excludedIds) {
      ...coinFragment
      ...messageFragment
    }
  }
  ${j}
  ${mt}
`,ee=u`
  query getContract($contractId: ContractId!) {
    contract(id: $contractId) {
      bytecode
      id
    }
  }
`,ae=u`
  query getBalance($owner: Address!, $assetId: AssetId!) {
    balance(owner: $owner, assetId: $assetId) {
      ...balanceFragment
    }
  }
  ${St}
`,re=u`
  query getBalances(
    $filter: BalanceFilterInput!
    $after: String
    $before: String
    $first: Int
    $last: Int
  ) {
    balances(filter: $filter, after: $after, before: $before, first: $first, last: $last) {
      edges {
        node {
          ...balanceFragment
        }
      }
    }
  }
  ${St}
`,se=u`
  query getMessages($owner: Address!, $after: String, $before: String, $first: Int, $last: Int) {
    messages(owner: $owner, after: $after, before: $before, first: $first, last: $last) {
      edges {
        node {
          ...messageFragment
        }
      }
    }
  }
  ${mt}
`,ne=u`
  query getMessageProof($transactionId: TransactionId!, $messageId: MessageId!) {
    messageProof(transactionId: $transactionId, messageId: $messageId) {
      ...messageProofFragment
    }
  }
  ${Ut}
`,oe=u`
  mutation dryRun($encodedTransaction: HexString!, $utxoValidation: Boolean) {
    dryRun(tx: $encodedTransaction, utxoValidation: $utxoValidation) {
      ...receiptFragment
    }
  }
  ${gt}
`,ie=u`
  mutation submit($encodedTransaction: HexString!) {
    submit(tx: $encodedTransaction) {
      id
    }
  }
`,ce=u`
  mutation startSession {
    startSession
  }
`,ue=u`
  mutation endSession($sessionId: ID!) {
    endSession(id: $sessionId)
  }
`,pe=u`
  mutation execute($sessionId: ID!, $op: String!) {
    execute(id: $sessionId, op: $op)
  }
`,le=u`
  mutation reset($sessionId: ID!) {
    reset(id: $sessionId)
  }
`,ye=(r,t,e)=>r();function ft(r,t=ye){return{getVersion(e,a){return t(s=>r.request(Nt,e,{...a,...s}),"getVersion","query")},getInfo(e,a){return t(s=>r.request(Vt,e,{...a,...s}),"getInfo","query")},getChain(e,a){return t(s=>r.request(Ht,e,{...a,...s}),"getChain","query")},getTransaction(e,a){return t(s=>r.request(Wt,e,{...a,...s}),"getTransaction","query")},getTransactionWithReceipts(e,a){return t(s=>r.request(vt,e,{...a,...s}),"getTransactionWithReceipts","query")},getTransactions(e,a){return t(s=>r.request(Kt,e,{...a,...s}),"getTransactions","query")},getTransactionsByOwner(e,a){return t(s=>r.request(zt,e,{...a,...s}),"getTransactionsByOwner","query")},getBlock(e,a){return t(s=>r.request(Zt,e,{...a,...s}),"getBlock","query")},getBlockWithTransactions(e,a){return t(s=>r.request(jt,e,{...a,...s}),"getBlockWithTransactions","query")},getBlocks(e,a){return t(s=>r.request(Xt,e,{...a,...s}),"getBlocks","query")},getCoin(e,a){return t(s=>r.request(Jt,e,{...a,...s}),"getCoin","query")},getCoins(e,a){return t(s=>r.request(Yt,e,{...a,...s}),"getCoins","query")},getResourcesToSpend(e,a){return t(s=>r.request(te,e,{...a,...s}),"getResourcesToSpend","query")},getContract(e,a){return t(s=>r.request(ee,e,{...a,...s}),"getContract","query")},getBalance(e,a){return t(s=>r.request(ae,e,{...a,...s}),"getBalance","query")},getBalances(e,a){return t(s=>r.request(re,e,{...a,...s}),"getBalances","query")},getMessages(e,a){return t(s=>r.request(se,e,{...a,...s}),"getMessages","query")},getMessageProof(e,a){return t(s=>r.request(ne,e,{...a,...s}),"getMessageProof","query")},dryRun(e,a){return t(s=>r.request(oe,e,{...a,...s}),"dryRun","mutation")},submit(e,a){return t(s=>r.request(ie,e,{...a,...s}),"submit","mutation")},startSession(e,a){return t(s=>r.request(ce,e,{...a,...s}),"startSession","mutation")},endSession(e,a){return t(s=>r.request(ue,e,{...a,...s}),"endSession","mutation")},execute(e,a){return t(s=>r.request(pe,e,{...a,...s}),"execute","mutation")},reset(e,a){return t(s=>r.request(le,e,{...a,...s}),"reset","mutation")}}}import{arrayify as it,hexlify as x}from"@ethersproject/bytes";import{AbiCoder as Me}from"@fuel-ts/abi-coder";import{Address as q}from"@fuel-ts/address";import{NativeAssetId as wt}from"@fuel-ts/constants";import{max as ke,bn as i}from"@fuel-ts/math";import{TransactionType as Pe,InputMessageCoder as Ot,MAX_GAS_PER_TX as Qt,ReceiptType as Lt,ReceiptCoder as Ae,TransactionCoder as Dt}from"@fuel-ts/transactions";import{GraphQLClient as we}from"graphql-request";import Oe from"lodash.clonedeep";var It=r=>"utxoId"in r,Ke=r=>"recipient"in r,_=r=>"id"in r,ze=r=>"recipient"in r;import{arrayify as I,hexlify as f}from"@ethersproject/bytes";import{ZeroBytes32 as X}from"@fuel-ts/constants";import{bn as J,toNumber as L}from"@fuel-ts/math";import{InputType as R}from"@fuel-ts/transactions";var xt=r=>{var t,e,a,s,n;switch(r.type){case R.Coin:{let o=I((t=r.predicate)!=null?t:"0x"),p=I((e=r.predicateData)!=null?e:"0x");return{type:R.Coin,utxoID:{transactionId:f(I(r.id).slice(0,32)),outputIndex:I(r.id)[32]},owner:f(r.owner),amount:J(r.amount),assetId:f(r.assetId),txPointer:{blockHeight:L(I(r.txPointer).slice(0,8)),txIndex:L(I(r.txPointer).slice(8,16))},witnessIndex:r.witnessIndex,maturity:(a=r.maturity)!=null?a:0,predicateLength:o.length,predicateDataLength:p.length,predicate:f(o),predicateData:f(p)}}case R.Contract:return{type:R.Contract,utxoID:{transactionId:X,outputIndex:0},balanceRoot:X,stateRoot:X,txPointer:{blockHeight:L(I(r.txPointer).slice(0,8)),txIndex:L(I(r.txPointer).slice(8,16))},contractID:f(r.contractId)};case R.Message:{let o=I((s=r.predicate)!=null?s:"0x"),p=I((n=r.predicateData)!=null?n:"0x");return{type:R.Message,sender:f(r.sender),recipient:f(r.recipient),amount:J(r.amount),nonce:J(r.nonce),witnessIndex:r.witnessIndex,dataLength:r.data.length,predicateLength:o.length,predicateDataLength:p.length,data:f(r.data),predicate:f(o),predicateData:f(p)}}default:throw new Error("Invalid Input type")}};import{hexlify as G}from"@ethersproject/bytes";import{ZeroBytes32 as D}from"@fuel-ts/constants";import{bn as F}from"@fuel-ts/math";import{OutputType as S}from"@fuel-ts/transactions";var qt=r=>{switch(r.type){case S.Coin:return{type:S.Coin,to:G(r.to),amount:F(r.amount),assetId:G(r.assetId)};case S.Contract:return{type:S.Contract,inputIndex:r.inputIndex,balanceRoot:D,stateRoot:D};case S.Message:return{type:S.Message,recipient:G(r.recipient),amount:F(r.amount)};case S.Change:return{type:S.Change,to:G(r.to),amount:F(0),assetId:G(r.assetId)};case S.Variable:return{type:S.Variable,to:D,amount:F(0),assetId:D};case S.ContractCreated:return{type:S.ContractCreated,contractId:G(r.contractId),stateRoot:G(r.stateRoot)};default:throw new Error("Invalid Output type")}};import{arrayify as P,hexlify as h}from"@ethersproject/bytes";import{addressify as k}from"@fuel-ts/address";import{NativeAssetId as et,ZeroBytes32 as at}from"@fuel-ts/constants";import{bn as U}from"@fuel-ts/math";import{TransactionType as T,TransactionCoder as Ge,InputType as b,OutputType as m,GAS_PRICE_FACTOR as Re}from"@fuel-ts/transactions";import{arrayify as bt}from"@ethersproject/bytes";import{multiply as de,bn as ht}from"@fuel-ts/math";import{FAILED_TRANSFER_TO_ADDRESS_SIGNAL as ge,GAS_PRICE_FACTOR as me,ReceiptType as $}from"@fuel-ts/transactions";var Y=r=>{if(r.length==null&&typeof r=="object"){let t=Object.keys(r).length;return bt({...r,length:t})}return bt(r)},tt=(r,t,e)=>ht(Math.ceil(r.toNumber()/e.toNumber())*t.toNumber()),Se=r=>{let t=r.find(e=>e.type===$.ScriptResult);return t&&t.type===$.ScriptResult?t.gasUsed:ht(0)};function Gt(r=1e3){return new Promise(t=>{setTimeout(()=>{t(!0)},r)})}var fe=r=>r.type===$.Revert&&r.val.toString("hex")===ge,Ie=r=>r.type===$.Panic&&r.contractId!=="0x0000000000000000000000000000000000000000000000000000000000000000",Rt=r=>r.reduce((t,e)=>(fe(e)&&t.missingOutputVariables.push(e),Ie(e)&&t.missingOutputContractIds.push(e),t),{missingOutputVariables:[],missingOutputContractIds:[]}),M=({receipts:r,gasPrice:t,margin:e})=>{let a=de(Se(r),e||1),s=tt(a,t,me);return{gasUsed:a,fee:s}};import{hexlify as Tt,arrayify as xe}from"@ethersproject/bytes";var qe=r=>{let t=new Uint8Array(32);return t.set(xe(r)),t},Ct=r=>{let t,e;return Array.isArray(r)?(t=r[0],e=r[1]):(t=r.key,e=r.value),{key:Tt(t),value:Tt(qe(e))}};import{arrayify as be,hexlify as he}from"@ethersproject/bytes";var Bt=r=>{let t=be(r);return{data:he(t),dataLength:t.length}};var _t={bytes:P("0x24000000"),encodeScriptData:()=>new Uint8Array(0)},Ca={bytes:P("0x5040C0105D44C0064C40001124000000"),encodeScriptData:()=>new Uint8Array(0)},E=class extends Error{constructor(){super(...arguments);this.name="ChangeOutputCollisionError";this.message='A ChangeOutput with the same "assetId" already exists for a different "to" address'}},rt=class extends Error{constructor(e){super();this.index=e;this.name="NoWitnessAtIndexError";this.message=`Witness at index "${e}" was not found`}},st=class extends Error{constructor(e){super();this.owner=e;this.name="NoWitnessByOwnerError";this.message=`A witness for the given owner "${e}" was not found`}},N=class{constructor({gasPrice:t,gasLimit:e,maturity:a,inputs:s,outputs:n,witnesses:o}={}){this.inputs=[];this.outputs=[];this.witnesses=[];this.gasPrice=U(t!=null?t:0),this.gasLimit=U(e!=null?e:0),this.maturity=a!=null?a:0,this.inputs=[...s!=null?s:[]],this.outputs=[...n!=null?n:[]],this.witnesses=[...o!=null?o:[]]}getBaseTransaction(){var s,n,o,p,c,y;let t=(n=(s=this.inputs)==null?void 0:s.map(xt))!=null?n:[],e=(p=(o=this.outputs)==null?void 0:o.map(qt))!=null?p:[],a=(y=(c=this.witnesses)==null?void 0:c.map(Bt))!=null?y:[];return{gasPrice:this.gasPrice,gasLimit:this.gasLimit,maturity:this.maturity,inputs:t,outputs:e,witnesses:a,inputsCount:t.length,outputsCount:e.length,witnessesCount:a.length}}toTransactionBytes(){return new Ge().encode(this.toTransaction())}pushInput(t){return this.inputs.push(t),this.inputs.length-1}pushOutput(t){return this.outputs.push(t),this.outputs.length-1}createWitness(){return this.witnesses.push("0x"),this.witnesses.length-1}updateWitnessByOwner(t,e){let a=this.getCoinInputWitnessIndexByOwner(t);typeof a=="number"&&this.updateWitness(a,e)}updateWitness(t,e){if(!this.witnesses[t])throw new rt(t);this.witnesses[t]=e}getCoinInputs(){return this.inputs.filter(t=>t.type===b.Coin)}getCoinOutputs(){return this.outputs.filter(t=>t.type===m.Coin)}getChangeOutputs(){return this.outputs.filter(t=>t.type===m.Change)}getCoinInputWitnessIndexByOwner(t){var a,s;let e=k(t);return(s=(a=this.inputs.find(n=>n.type===b.Coin&&n.owner===e.toB256()))==null?void 0:a.witnessIndex)!=null?s:null}updateWitnessByCoinInputOwner(t,e){let a=this.getCoinInputWitnessIndexByOwner(t);if(!a)throw new st(k(t));this.updateWitness(a,e)}addResource(t){let e=_(t)?t.owner:t.recipient,a=_(t)?t.assetId:et,s=_(t)?b.Coin:b.Message,n=this.getCoinInputWitnessIndexByOwner(e);typeof n!="number"&&(n=this.createWitness()),this.pushInput(_(t)?{type:s,...t,owner:t.owner.toB256(),witnessIndex:n,txPointer:"0x00000000000000000000000000000000"}:{type:s,...t,sender:t.sender.toB256(),recipient:t.recipient.toB256(),witnessIndex:n,txPointer:"0x00000000000000000000000000000000"});let o=this.getChangeOutputs().find(p=>h(p.assetId)===a);if(o&&h(o.to)!==e.toB256())throw new E;o||this.pushOutput({type:m.Change,to:e.toB256(),assetId:a})}addResources(t){t.forEach(e=>this.addResource(e))}addCoin(t){let e=this.getCoinInputWitnessIndexByOwner(t.owner);typeof e!="number"&&(e=this.createWitness()),this.pushInput({type:b.Coin,...t,owner:t.owner.toB256(),witnessIndex:e,txPointer:"0x00000000000000000000000000000000"});let a=this.getChangeOutputs().find(s=>h(s.assetId)===t.assetId);if(a&&h(a.to)!==t.owner.toB256())throw new E;a||this.pushOutput({type:m.Change,to:t.owner.toB256(),assetId:t.assetId})}addCoins(t){t.forEach(e=>this.addCoin(e))}addCoinOutput(t,e,a=et){this.pushOutput({type:m.Coin,to:k(t).toB256(),amount:e,assetId:a})}addCoinOutputs(t,e){e.map(O).forEach(a=>{this.pushOutput({type:m.Coin,to:k(t).toB256(),amount:a.amount,assetId:a.assetId})})}byteSize(){return this.toTransactionBytes().length}chargeableByteSize(){let t=this.witnesses.reduce((e,a)=>e+P(a).length,0);return U(this.toTransactionBytes().length-t)}calculateFee(){let t=tt(this.gasLimit,this.gasPrice,Re);return{assetId:et,amount:t.isZero()?U(1):t}}addMessage(t){let e=this.getCoinInputWitnessIndexByOwner(t.recipient);typeof e!="number"&&(e=this.createWitness()),this.pushInput({type:b.Message,...t,sender:t.sender.toBytes(),recipient:t.recipient.toBytes(),witnessIndex:e})}addMessages(t){t.forEach(e=>this.addMessage(e))}},C=class extends N{constructor({script:e,scriptData:a,...s}={}){super(s);this.type=T.Script;this.script=Y(e!=null?e:_t.bytes),this.scriptData=Y(a!=null?a:_t.encodeScriptData())}static from(e){return e instanceof this?e:new this(e)}toTransaction(){var s,n;let e=P((s=this.script)!=null?s:"0x"),a=P((n=this.scriptData)!=null?n:"0x");return{type:T.Script,...super.getBaseTransaction(),scriptLength:e.length,scriptDataLength:a.length,receiptsRoot:at,script:h(e),scriptData:h(a)}}getContractInputs(){return this.inputs.filter(e=>e.type===b.Contract)}getContractOutputs(){return this.outputs.filter(e=>e.type===m.Contract)}getVariableOutputs(){return this.outputs.filter(e=>e.type===m.Variable)}setScript(e,a){this.script=e.bytes,this.scriptData=e.encodeScriptData(a),this.bytesOffset===void 0&&(this.bytesOffset=this.scriptData.byteLength)}addVariableOutputs(e=1){let a=e;for(;a;)this.pushOutput({type:m.Variable}),a-=1;return this.outputs.length-1}addMessageOutputs(e=1){let a=e;for(;a;)this.pushOutput({type:m.Message,recipient:"0x0000000000000000000000000000000000000000000000000000000000000000",amount:0}),a-=1;return this.outputs.length-1}addContract(e){let a=k(e);if(this.getContractInputs().find(n=>n.contractId===a.toB256()))return;let s=super.pushInput({type:b.Contract,contractId:a.toB256(),txPointer:"0x00000000000000000000000000000000"});this.pushOutput({type:m.Contract,inputIndex:s})}},V=class extends N{constructor({bytecodeWitnessIndex:e,salt:a,storageSlots:s,...n}={}){super(n);this.type=T.Create;this.bytecodeWitnessIndex=e!=null?e:0,this.salt=h(a!=null?a:at),this.storageSlots=[...s!=null?s:[]]}static from(e){return e instanceof this?e:new this(e)}toTransaction(){var n,o;let e=this.getBaseTransaction(),a=this.bytecodeWitnessIndex,s=(o=(n=this.storageSlots)==null?void 0:n.map(Ct))!=null?o:[];return{type:T.Create,...e,bytecodeLength:e.witnesses[a].dataLength/4,bytecodeWitnessIndex:a,storageSlotsCount:s.length,salt:this.salt?h(this.salt):at,storageSlots:s}}getContractCreatedOutputs(){return this.outputs.filter(e=>e.type===m.ContractCreated)}addContractCreatedOutput(e,a){this.pushOutput({type:m.ContractCreated,contractId:e,stateRoot:a})}},A=r=>{if(r instanceof C||r instanceof V)return r;switch(r.type){case T.Script:return C.from(r);case T.Create:return V.from(r);default:throw new Error(`Unknown transaction type: ${r.type}`)}};import{arrayify as Pt}from"@ethersproject/bytes";import{bn as nt}from"@fuel-ts/math";import{TransactionCoder as Te,ReceiptType as Mt,ReceiptCoder as Ce}from"@fuel-ts/transactions";var Be=5e3,_e=500,kt=r=>{let t=new Ce().decode(Pt(r.rawPayload),0)[0];switch(t.type){case Mt.ReturnData:return{...t,data:r.data};case Mt.LogData:return{...t,data:r.data};default:return t}},W,At,H=class{constructor(t,e){ut(this,W);this.gasUsed=nt(0);this.attempts=0;this.id=t,this.provider=e}async waitForResult(){var a,s;let t=await pt(this,W,At).call(this),e=(a=new Te().decode(Pt(t.rawPayload),0))==null?void 0:a[0];switch((s=t.status)==null?void 0:s.type){case"SubmittedStatus":return this.attempts+=1,await Gt(Math.min(_e*this.attempts,Be)),this.waitForResult();case"FailureStatus":{let n=t.receipts.map(kt),{gasUsed:o,fee:p}=M({receipts:n,gasPrice:nt(t==null?void 0:t.gasPrice)});return this.gasUsed=o,{status:{type:"failure",reason:t.status.reason},receipts:n,transactionId:this.id,blockId:t.status.block.id,time:t.status.time,gasUsed:o,fee:p,transaction:e}}case"SuccessStatus":{let n=t.receipts.map(kt),{gasUsed:o,fee:p}=M({receipts:n,gasPrice:nt(t==null?void 0:t.gasPrice)});return{status:{type:"success",programState:t.status.programState},receipts:n,transactionId:this.id,blockId:t.status.block.id,time:t.status.time,gasUsed:o,fee:p,transaction:e}}default:throw new Error("Invalid Transaction status")}}async wait(){let t=await this.waitForResult();if(t.status.type==="failure")throw new Error(`Transaction failed: ${t.status.reason}`);return t}};W=new WeakSet,At=async function(){let{transaction:t}=await this.provider.operations.getTransactionWithReceipts({transactionId:this.id});if(!t)throw new Error("No Transaction was received from the client.");return t};var Qe=10,ot=r=>{let t=new Ae().decode(it(r.rawPayload),0)[0];switch(t.type){case Lt.ReturnData:return{...t,data:r.data};case Lt.LogData:return{...t,data:r.data};default:return t}},Le=r=>({name:r.name,baseChainHeight:i(r.baseChainHeight),peerCount:r.peerCount,consensusParameters:{gasPriceFactor:i(r.consensusParameters.gasPriceFactor),maxGasPerTx:i(r.consensusParameters.maxGasPerTx),maxScriptLength:i(r.consensusParameters.maxScriptLength)},latestBlock:{id:r.latestBlock.id,height:i(r.latestBlock.header.height),time:r.latestBlock.header.time,transactions:r.latestBlock.transactions.map(t=>({id:t.id}))}}),De=r=>({minGasPrice:i(r.minGasPrice),nodeVersion:r.nodeVersion}),v=class{constructor(t){this.url=t;this.addMissingVariables=async t=>{let e=0,a=0,s=0;if(t.type!==Pe.Create)do{let n=x(t.toTransactionBytes()),{dryRun:o}=await this.operations.dryRun({encodedTransaction:n,utxoValidation:!1}),p=o.map(ot),{missingOutputVariables:c,missingOutputContractIds:y}=Rt(p);if(e=c.length,a=y.length,e===0&&a===0)return;t.addVariableOutputs(e),y.forEach(({contractId:l})=>t.addContract(q.fromString(l))),s+=1}while(s<Qe)};let e=new we(t);this.operations=ft(e)}async getVersion(){let{nodeInfo:{nodeVersion:t}}=await this.operations.getVersion();return t}async getNetwork(){return{name:"fuelv2",chainId:3735928559}}async getBlockNumber(){let{chain:t}=await this.operations.getChain();return i(t.latestBlock.header.height,10)}async getNodeInfo(){let{nodeInfo:t}=await this.operations.getInfo();return De(t)}async getChain(){let{chain:t}=await this.operations.getChain();return Le(t)}async sendTransaction(t){let e=A(t);await this.addMissingVariables(e);let a=x(e.toTransactionBytes()),{gasUsed:s,minGasPrice:n}=await this.getTransactionCost(e,0);if(i(s).gt(i(e.gasLimit)))throw new Error(`gasLimit(${e.gasLimit}) is lower than the required (${s})`);if(i(n).gt(i(e.gasPrice)))throw new Error(`gasPrice(${e.gasPrice}) is lower than the required ${n}`);let{submit:{id:o}}=await this.operations.submit({encodedTransaction:a});return new H(o,this)}async call(t,{utxoValidation:e}={}){let a=A(t);await this.addMissingVariables(a);let s=x(a.toTransactionBytes()),{dryRun:n}=await this.operations.dryRun({encodedTransaction:s,utxoValidation:e||!1});return{receipts:n.map(ot)}}async simulate(t){let e=A(t);await this.addMissingVariables(e);let a=x(e.toTransactionBytes()),{dryRun:s}=await this.operations.dryRun({encodedTransaction:a,utxoValidation:!0});return{receipts:s.map(ot)}}async getTransactionCost(t,e=.2){let a=A(Oe(t)),{minGasPrice:s}=await this.getNodeInfo(),n=ke(a.gasPrice,s),o=1+e;a.gasLimit=Qt,a.gasPrice=i(0);let{receipts:p}=await this.call(a),{gasUsed:c,fee:y}=M({gasPrice:n,receipts:p,margin:o});return{minGasPrice:s,gasPrice:n,gasUsed:c,fee:y}}async getCoins(t,e,a){return(await this.operations.getCoins({first:10,...a,filter:{owner:t.toB256(),assetId:e&&x(e)}})).coins.edges.map(o=>o.node).map(o=>({id:o.utxoId,assetId:o.assetId,amount:i(o.amount),owner:q.fromAddressOrString(o.owner),status:o.status,maturity:i(o.maturity).toNumber(),blockCreated:i(o.blockCreated)}))}async getResourcesToSpend(t,e,a){var o,p;let s={messages:((o=a==null?void 0:a.messages)==null?void 0:o.map(c=>x(c)))||[],utxos:((p=a==null?void 0:a.utxos)==null?void 0:p.map(c=>x(c)))||[]};return(await this.operations.getResourcesToSpend({owner:t.toB256(),queryPerAsset:e.map(O).map(({assetId:c,amount:y,max:l})=>({assetId:x(c),amount:y.toString(10),max:l?l.toString(10):void 0})),excludedIds:s})).resourcesToSpend.flat().map(c=>It(c)?{id:c.utxoId,amount:i(c.amount),status:c.status,assetId:c.assetId,owner:q.fromAddressOrString(c.owner),maturity:i(c.maturity).toNumber(),blockCreated:i(c.blockCreated)}:{sender:q.fromAddressOrString(c.sender),recipient:q.fromAddressOrString(c.recipient),nonce:i(c.nonce),amount:i(c.amount),data:Ot.decodeData(c.data),daHeight:i(c.daHeight),fuelBlockSpend:i(c.fuelBlockSpend)})}async getBlock(t){let e;typeof t=="number"?e={blockHeight:i(t).toString(10)}:t==="latest"?e={blockHeight:(await this.getBlockNumber()).toString(10)}:e={blockId:i(t).toString(10)};let{block:a}=await this.operations.getBlock(e);return a?{id:a.id,height:i(a.header.height),time:a.header.time,transactionIds:a.transactions.map(s=>s.id)}:null}async getBlockWithTransactions(t){let e;typeof t=="number"?e={blockHeight:i(t).toString(10)}:t==="latest"?e={blockHeight:(await this.getBlockNumber()).toString()}:e={blockId:t};let{block:a}=await this.operations.getBlockWithTransactions(e);return a?{id:a.id,height:i(a.header.height,10),time:a.header.time,transactionIds:a.transactions.map(s=>s.id),transactions:a.transactions.map(s=>{var n;return(n=new Dt().decode(it(s.rawPayload),0))==null?void 0:n[0]})}:null}async getTransaction(t){var a;let{transaction:e}=await this.operations.getTransaction({transactionId:t});return e?(a=new Dt().decode(it(e.rawPayload),0))==null?void 0:a[0]:null}async getContract(t){let{contract:e}=await this.operations.getContract({contractId:t});return e||null}async getBalance(t,e){let{balance:a}=await this.operations.getBalance({owner:t.toB256(),assetId:x(e)});return i(a.amount,10)}async getBalances(t,e){return(await this.operations.getBalances({first:10,...e,filter:{owner:t.toB256()}})).balances.edges.map(n=>n.node).map(n=>({assetId:n.assetId,amount:i(n.amount)}))}async getMessages(t,e){return(await this.operations.getMessages({first:10,...e,owner:t.toB256()})).messages.edges.map(n=>n.node).map(n=>({sender:q.fromAddressOrString(n.sender),recipient:q.fromAddressOrString(n.recipient),nonce:i(n.nonce),amount:i(n.amount),data:Ot.decodeData(n.data),daHeight:i(n.daHeight),fuelBlockSpend:i(n.fuelBlockSpend)}))}async getMessageProof(t,e){let a=await this.operations.getMessageProof({transactionId:t,messageId:e});return a.messageProof?{proofSet:a.messageProof.proofSet,proofIndex:i(a.messageProof.proofIndex),sender:q.fromAddressOrString(a.messageProof.sender),recipient:q.fromAddressOrString(a.messageProof.recipient),nonce:a.messageProof.nonce,amount:i(a.messageProof.amount),data:a.messageProof.data,signature:a.messageProof.signature,header:{id:a.messageProof.header.id,daHeight:i(a.messageProof.header.daHeight),transactionsCount:i(a.messageProof.header.transactionsCount),outputMessagesCount:i(a.messageProof.header.outputMessagesCount),transactionsRoot:a.messageProof.header.transactionsRoot,outputMessagesRoot:a.messageProof.header.outputMessagesRoot,height:i(a.messageProof.header.height),prevRoot:a.messageProof.header.prevRoot,time:a.messageProof.header.time,applicationHash:a.messageProof.header.applicationHash}}:null}async buildSpendPredicate(t,e,a,s,n=wt,o,p){let c=await this.getResourcesToSpend(t.address,[[e,n]]),y={fundTransaction:!0,...o},l=new C({gasLimit:Qt,...y}),K;s&&t.types&&(K=new Me().encode(t.types,s));let z=c.reduce((w,ct)=>(l.addResource({...ct,predicate:t.bytes,predicateData:K}),l.outputs=[],w.add(ct.amount)),i(0));l.addCoinOutput(a,z,n);let Z=[];if(y.fundTransaction&&Z.push(l.calculateFee()),Z.length&&p){let w=await this.getResourcesToSpend(p,Z);l.addResources(w)}return l}async submitSpendPredicate(t,e,a,s,n=wt,o,p){var y;let c=await this.buildSpendPredicate(t,e,a,s,n,o,p);try{return await(await this.sendTransaction(c)).waitForResult()}catch(l){throw(((y=l==null?void 0:l.response)==null?void 0:y.errors)||[]).some(({message:z})=>z.includes("unexpected block execution error TransactionValidity(InvalidPredicate"))?new Error("Invalid Predicate"):l}}};export{E as ChangeOutputCollisionError,dt as CoinStatus,V as CreateTransactionRequest,rt as NoWitnessAtIndexError,st as NoWitnessByOwnerError,v as Provider,C as ScriptTransactionRequest,H as TransactionResponse,T as TransactionType,Y as arraifyFromUint8Array,tt as calculatePriceWithFactor,M as calculateTransactionFee,O as coinQuantityfy,Se as getGasUsedFromReceipts,Rt as getReceiptsWithMissingData,xt as inputify,_ as isCoin,ze as isMessage,It as isRawCoin,Ke as isRawMessage,qt as outputify,_t as returnZeroScript,Gt as sleep,A as transactionRequestify,Ca as withdrawScript};
//# sourceMappingURL=index.mjs.map